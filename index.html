/*** SMART INVESTMENT ADVISOR ***/
var smartInvestmentLayer;

function createSmartInvestmentLayer() {

    if (!layers.polys["Agricultural Land"] ||
        !layers.polys["Temperature Zones"] ||
        !layers.polys["Built-up Areas"]) {
        return;
    }

    var agri = layers.polys["Agricultural Land"].toGeoJSON();
    var temp = layers.polys["Temperature Zones"].toGeoJSON();
    var built = layers.polys["Built-up Areas"].toGeoJSON();

    var investmentFeatures = [];

    agri.features.forEach(a => {
        temp.features.forEach(t => {
            built.features.forEach(b => {

                if (turf.intersect(a, t) && turf.intersect(a, b)) {
                    investmentFeatures.push(a);
                }

            });
        });
    });

    smartInvestmentLayer = L.geoJson({
        type: "FeatureCollection",
        features: investmentFeatures
    }, {
        style: {
            color: "#00b894",
            fillColor: "#55efc4",
            weight: 2,
            fillOpacity: 0.7
        }
    }).addTo(map);

    layers.polys["Smart Investment Advisor"] = smartInvestmentLayer;
    control.addOverlay(smartInvestmentLayer, "Smart Investment Advisor");

    document.getElementById("opacity-select").innerHTML +=
        `<option value="Smart Investment Advisor">Smart Investment Advisor</option>`;
}

/*** LOAD TURF FOR SPATIAL INTERSECTION ***/
var turfScript = document.createElement("script");
turfScript.src = "https://unpkg.com/@turf/turf@6/turf.min.js";
turfScript.onload = function () {
    setTimeout(createSmartInvestmentLayer, 2000);
};
document.head.appendChild(turfScript);
